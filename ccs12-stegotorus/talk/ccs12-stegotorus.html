<!DOCTYPE html>
<html><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <title>StegoTorus: A Camouflage Proxy for the Tor Anonymity System</title>

  <link rel="stylesheet" href="r/fonts.css">
  <link rel="stylesheet" href="r/prez-cylab.css">
</head>
<body>

<section class="title">
  <hgroup>
    <h1>StegoTorus:<br>A Camouflage Proxy for the<br>Tor Anonymity System</h1>
    <h2><b>Zachary Weinberg</b> · Jeffrey Wang<br>Vinod Yegneswaran ·
        Linda Briesemeister<br>Steven Cheung · Frank Wang · Dan Boneh</h2>
    <h3>CMU · SRI International · Stanford</h3>
  </hgroup>
</section>

<section>
  <h2>Tor and Censorship</h2>
  <object data="tor-background-1.svg" width="773.5" height="346"></object>
  <p>The Onion Router (Tor)<br>conceals the source and destination of
  traffic<br>by relaying it through a chain of proxies</p>
</section>

<section>
  <h2>Tor and Censorship</h2>
  <object data="tor-background-2.svg" width="773.5" height="346"></object>
  <p>Any of these routers could be eavesdropping<br>
  Any of these routers could cut off communications</p>
</section>

<section>
  <h2>Tor and Censorship</h2>
  <object data="tor-background-3.svg" width="773.5" height="346"></object>
  <p>The <b>censor</b>, an adversary in this position,<br>
     regularly does cut off communications</p>
</section>

<section>
  <h2>StegoTorus</h2>
  <object data="tor-background-4.svg" width="773.5" height="346"></object>
  <p style="">Disguise Tor traffic as an innocuous cover
  protocol<br>so the censor does not detect and block it</p>
</section>

<section>
  <h2>Actual incident</h2>
  <figure>
    <p>Directly connecting users from Iran</p>
    <object data="direct-users-iran.svg" width="900" height="500"></object>
    <figcaption>
      Data from the Tor Project
      — <a href="https://metrics.torproject.org">https://metrics.torproject.org</a>
      </figcaption>
  </figure>
</section>

<section>
  <h2>Stegotorus’ Mission</h2>
  <p>Protect <b>bulk Tor traffic</b> from deep-packet inspection and
     blockade</p>
  <p>… hide it, steganographically, in commonplace Internet
  protocols</p>
  <p>… obscure packet contents, size, and timing</p>
  <p>… maintain Tor’s anonymity properties and performance</p>
</section>

<section>
  <h2>About steganography</h2>
  <p>Hide a <b>hiddentext</b> in a <b>covertext</b>; an adversary
     shouldn’t be able to tell that the hiddentext is present</p>
  <p>The covertext conforms to some standard file format<br>
    (in our case, a standard TCP protocol)</p>
  <p>State of the art is weaker than for cryptography</p>
  <ul>
    <li>theoretically-secure designs are not yet practical</li>
    <li>deployed designs can all be broken by a determined
      adversary</li>
    <li>hiddentext must be <b>entirely</b> indistinguishable
      from random bits</li>
  </ul>
</section>

<section>
  <h2>DEFIANCE: the larger system</h2>
  <img src="defiance-arch.svg">
  <ul>
    <li>StegoTorus defends against packet inspection</li>
    <li>Other components provide IP-blocking resistance, preshared
        keys, protection from active probes and directory scraping,
        etc.</li>
    <li>More details: <a href="https://www.usenix.org/conference/foci12/bootstrapping-communications-anti-censorship-system">Lincoln et al.</a>, FOCI’12</li>
  </ul>
</section>

<section>
  <h2>Limits on the Censor</h2>
  <ul>
    <li>Doesn’t install spyware on users’ computers</li>
    <li>Doesn’t operate Tor relays</li>
    <li>Wishes to avoid collateral damage</li>
    <li>Has to make decisions at backbone scale
      <ul>
        <li>must ignore nearly all traffic
        <li>must detect “interesting” traffic with minimal CPU effort
        <li>must err on the side of missing things<br>(or be flooded in
        false positives)
      </ul>
    </li>
  </ul>
</section>

<section>
  <h2>StegoTorus Architecture</h2>
  <img src="architecture.svg">
</section>

<section>
  <h2>Chopping</h2>
  <img src="chop-block.svg">
  <div style="font-size:.6666em">
  <p>The Tor stream is not a good hidden protocol as is</p>
  <ul>
    <li>Plaintext record headers
    <li>Fixed-size “cells”
    <li>Must be delivered in order
  </ul>
  <p>Chopping reformats the stream to solve these issues</p>
  <ul>
    <li>Can be used by itself</li>
    <li>Think of it as a custom rebuild of TLS and TCP</li>
    <li>Two particularly hard design problems</li>
  </ul>
  </div>
</section>

<section>
  <h2>Hard problem 1</h2>
  <img src="chop-block.svg">
  <ul>
    <li>Must know length to decrypt; must decrypt length</li>
    <li>Encrypted, unauthenticated data leads to<br>decryption-oracle attacks</li>
    <li>Solution: separate key for header, short-message AE</li>
  </ul>
</section>

<section>
  <h2>Handshakes</h2>
  <div style="width: 50%; display: table-cell">
    <ul>
      <li>Create new Tor links
        <ul>
          <li>Pre-shared server public key</li>
          <li>Special asymmetric cipher for initial key agreement</li>
          <li>ECDH (fixed curve) for session key agreement</li>
        </ul>
      </li>
      <li>Associate new connections with established Tor links
        <ul>
          <li>Same asymmetric cipher as initial key agreement</li>
          <li>Needed to multiplex a Tor link over many cover-protocol
          connections</li>
        </ul>
      </li>
    </ul>
  </div>
  <div style="width: 50%; display: table-cell; vertical-align: top">
    <img src="chop-handshakes.svg">
  </div>
</section>

<section>
  <h2>Hard problem 2</h2>
  <div style="width: 50%; display: table-cell">
    <p>No standard asymmetric cipher produces pseudorandom ciphertexts</p>
    <p>We use <a href="http://www.bmoeller.de/pdf/pke-pseudo-esorics2004.pdf">Bodo
      Möller’s proposed cipher</a> from ESORICS 2004</p>
    <ul style="font-size: 1.5em">
      <li>First production implementation of this cipher (to our
        knowledge)</li>
      <li>Only good for initial key agreement</li>
      <li>Produces 163-<b>bit</b> messages</li>
      <li>Intrinsic timing attack<br>(see paper for fix)</li>
    </ul>
  </div>
  <div style="width: 50%; display: table-cell; vertical-align: top">
    <img src="chop-handshakes.svg">
  </div>
</section>

<section>
  <h2>Steganography</h2>
  <div style="width: 50%; display: table-cell">
    <p>Implemented:</p>
    <ul>
      <li>Arbitrary encrypted packet stream (“embed”)</li>
      <li>HTTP (JS, Flash, PDF)</li>
    </ul>
    <p>Planned:</p>
    <ul>
      <li>Skype, RTMP, WoW?</li>
      <li>More HTTP content types</li>
    </ul>
  </div>
  <div style="width: 50%; display: table-cell; vertical-align: middle">
    <img src="architecture.svg" width="100%">
  </div>
</section>

<section>
  <h2>Arbitrary encrypted packet stream</h2>
  <pre style="width:500px; float: right"
>17 03 01 00 6B XX XX XX  XX XX XX XX XX XX XX XX
XX XX XX XX XX XX XX XX  XX XX XX XX XX XX XX XX
XX XX XX XX XX XX XX XX  XX XX XX XX XX XX XX XX
XX XX XX XX XX XX XX XX  XX XX XX XX XX XX XX XX
XX XX XX XX XX XX XX XX  XX XX XX XX XX XX XX XX
XX XX XX XX XX XX XX XX  XX XX XX XX XX XX XX XX
XX XX XX XX XX XX XX XX  XX XX XX XX XX XX XX XX
MM MM MM MM MM MM MM MM  MM MM MM MM MM MM MM MM
MM MM MM MM PP</pre>
  <p>A TLS 1.0 application-data record, with 107 bytes of payload, a
    20-byte MAC,<br>and a 16-byte block cipher,<br>on the wire looks like
    this →</p>
</section>

<section>
  <h2>Arbitrary encrypted packet stream</h2>
  <pre style="width:500px; float: right"
>17 03 01 00 6B <b>XX XX XX  XX XX XX XX XX XX XX XX
XX XX XX XX XX XX XX XX  XX XX XX XX XX XX XX XX
XX XX XX XX XX XX XX XX  XX XX XX XX XX XX XX XX
XX XX XX XX XX XX XX XX  XX XX XX XX XX XX XX XX
XX XX XX XX XX XX XX XX  XX XX XX XX XX XX XX XX
XX XX XX XX XX XX XX XX  XX XX XX XX XX XX XX XX
XX XX XX XX XX XX XX XX  XX XX XX XX XX XX XX XX
MM MM MM MM MM MM MM MM  MM MM MM MM MM MM MM MM
MM MM MM MM PP</b></pre>
  <p>A TLS 1.0 application-data record, with 107 bytes of payload, a
    20-byte MAC,<br>and a 16-byte block cipher,<br>on the wire looks like
    this →</p>
  <p>Replace XX, MM, PP bytes with chopper output (adversary can’t
    check the MAC)</p>
  <p>Works from labeled packet captures of TLS streams</p>
  <p>Can be adapted to any TCP protocol carrying encrypted data</p>
  <p>Not reliable enough to benchmark yet</p>
</section>

<section>
  <h2>HTTP client → server</h2>
  <div style="width: 50%; display: table-cell">
    <p>Not much room to smuggle arbitrary data</p>
    <p>We use URIs and cookies, base64’d</p>
    <ul style="font-size:1.5em"><li>todo: make them look less fishy</li></ul>
    <p>Hostname impractical (has to be in the DNS)</p>
  </div>
  <div style="width: 50%; display: table-cell">
    <pre>GET /<b>&lt;uri&gt;</b> HTTP/1.1
Accept: text/html,application/xhtml+xml,
    application/xml;q=0.9,*/*;q=0.8
Accept-Encoding: gzip, deflate
Accept-Language: en-us,en;q=0.5
Connection: keep-alive
Host: <b>&lt;hostname&gt;</b>
User-Agent: Mozilla/5.0 (X11; Linux x86_64;
    rv:10.0) Gecko/20100101 Firefox/10.0
Cookie: <b>&lt;cookie&gt;</b></pre>
  </div>
</section>

<section>
  <h2>HTTP server → client: JavaScript</h2>
  <div style="width: 50%; display: table-cell">
    <p>JavaScript on the wire looks like this →</p>
    <p>Overwrite identifiers with hiddentext, encoded in modified
    base64</p>
  </div>
  <div style="width: 50%; display: table-cell">
<pre style="width:550px">(function(a,b){function cy(a){return f.isWindow(a)?a:
a.nodeType===9?a.defaultView||a.parentWindow:!1}funct
ion cv(a){if(!ck[a]){var b=c.body,d=f("&lt;"+a+"&gt;").appe
ndTo(b),e=d.css("display");d.remove();if(e==="none"||
e===""){cl||(cl=c.createElement("iframe"),cl.frameBor
der=cl.width=cl.height=0),b.appendChild(cl); if(!cm||
!cl.createElement)cm=(cl.contentWindow||cl.contentDoc
ument).document,cm.write((c.compatMode==="CSS1Compat"
?"&lt;!doctype html&gt;":"")+"&lt;html&gt;&lt;body&gt;"),cm.close();d=c
m.createElement(a),cm.body.appendChild(d),e=f.css(d,"
display"),b.removeChild(cl)}ck[a]=e}return ck[a]}func
tion cu(a,b){var c={};f.each(cq.concat.apply([],cq.sl
ice(0,b)),function(){c[this]=a});return c}function ct
(){cr=b}function cs(){setTimeout(ct,0);return cr=f.no
w()}function cj(){try{return new a.ActiveXObject("Mic
rosoft.XMLHTTP")}catch(b){}}function ci(){try{return
new a.XMLHttpRequest}catch(b){}}</pre>
  </div>
</section>

<section>
  <h2>HTTP server → client: JavaScript</h2>
  <div style="width: 50%; display: table-cell">
    <p>JavaScript on the wire looks like this →</p>
    <p>Overwrite identifiers with hiddentext, encoded in modified
    base64</p>
    <p>Preserve JS keywords</p>
    <p>Match hiddentext to covertext length</p>
    <p>Roughly 4x expansion</p>
  </div>
  <div style="width: 50%; display: table-cell">
<pre style="width:550px">(function(a,b){function c<b>y</b>(a){return f.i<b>FBEg__S</b>(a)?a:
a.n<b>LL5K5Wi</b>===9?a.d<b>b9pYVlj2x_</b>||a.p<b>jgALQ96LcyO</b>:!1}funct
ion c<b>r</b>(a){if(!c<b>Q</b>[a]){var b=c.b<b>c3B</b>,d=f("&lt;"+a+"&gt;").a<b>xb3
G9Tt</b>(b),e=d.c<b>Xk</b>("d<b>XKHE2w</b>");d.r<b>IASMb</b>();if(e==="n<b>2Ee</b>"||
e===""){c<b>O</b>||(c<b>5</b>=c.c<b>N1DbOy6nqtEC</b>("i<b>uuLEs</b>"),c<b>O</b>.f<b>a61AM_r
8jS</b>=c<b>R</b>.w<b>oPoZ</b>=c<b>W</b>.h<b>hWBrU</b>=0),b.a<b>JGbdVaYlk8</b>(c<b>C</b>); if(!c<b>2</b>||
!c<b>9</b>.c<b>1fwWKhvnD6_c</b>)c<b>$</b>=(c<b>Z</b>.c<b>ZH$L2wDJNHLw</b>||c<b>N</b>.c<b>vmE_b4U5S
gSSuD</b>).d<b>_ZhSZRx</b>,c<b>Q</b>.w<b>WbjY</b>((c.c<b>Aa6p$s6IC</b>==="C<b>iQeit2Lzj</b>"
?"&lt;!d<b>EotywD</b> h<b>P3E</b>&gt;":"")+"&lt;h<b>y3a</b>&gt;&lt;b<b>1aC</b>&gt;"),c<b>9</b>.c<b>L84t</b>();d=c
<b>4</b>.c<b>o6tjDiP3gw0_</b>(a),c<b>g</b>.b<b>zgO</b>.a<b>atDzQr5Wjd</b>(d),e=f.c<b>zd</b>(d,"
d<b>7ZOzw0</b>"),b.r<b>hXN3BFJBW9</b>(c<b>f</b>)}c<b>h</b>[a]=e}return c<b>Y</b>[a]}func
tion c<b>S</b>(a,b){var c={};f.e<b>R2T</b>(c<b>u</b>.c<b>KRRLv</b>.a<b>Wpza</b>([],c<b>_</b>.s<b>T
zv9</b>(0,b)),function(){c[this]=a});return c}function c<b>d</b>
(){c<b>X</b>=b}function c<b>x</b>(){s<b>2pX1jv7ka</b>(c<b>i</b>,0);return c<b>A</b>=f.n<b>e
d</b>()}function c<b>f</b>(){try{return new a.A<b>_i8qX_4HizjJ</b>("M<b>Ef
DhOFVY</b>.X<b>hXvKkJ</b>")}catch(b){}}function c<b>w</b>(){try{return
new a.X<b>rcSdu8P4nzNod</b>}catch(b){}}</pre>
  </div>
</section>

<section>
  <h2>Packet-level distinguisher</h2>
  <figure>
    <p>The first 20 packets of 64,000 port-443 TCP flows, binned by size</p>
    <object data="machine-classification.svg"></object>
    <figcaption><a href="http://www.caida.org/data/passive/passive_2011_dataset.xml">CAIDA
    Anonymized Internet Traces 2011 (Chicago)</a></figcaption>
</section>

<section>
  <h2>Traffic Analysis Resistance</h2>
  <img src="traffic-analysis-resist.svg">
  <div style="font-size:.66em">
  <p>StegoTorus-HTTP is much more like CAIDA-port-80 traffic than
    either is like Tor traffic</p>
  <p>StegoTorus-HTTP is still distinguishable from true HTTP</p>
  </div>
</section>

<section>
  <h2>Performance</h2>
  <img src="performance.svg">
  <div style="font-size:.66em">
  <p>The chopper by itself adds a small amount of overhead</p>
  <p>HTTP steganography adds a great deal more</p>
  <p>ST-HTTP is still usable for casual web surfing (comparable to
  dial-up)</p>
  </div>
</section>

<section>
  <h2>What’s Next — Short Term</h2>
  <p>Still to do:</p>
  <ul>
    <li>Reduce overhead</li>
    <li>Make HTTP steg less latency-sensitive</li>
    <li>More and better steganography</li>
    <li>Decoy traffic</li>
    <li>Collect covertexts from end user</li>
    <li>Test against genuine “deep packet inspection” gear</li>
  </ul>
  <p>Help wanted!</p>
</section>

<section>
  <h2>What’s Next — Long Term</h2>
  <div style="width: 45%; display: table-cell; font-size: .75em">
    <p>If censors can’t block all use of Tor, perhaps they will try to
      extract information instead</p>
    <p>Quite a bit of research on detecting website identity from
      traffic volume, packet timing, etc.</p>
    <p>We found this can be done in constant time per packet and
      constant memory per stream</p>
    <p>We are skeptical whether this scales from small closed-world
      experiments to the global Internet</p>
  </div>
  <div style="width: 5%; display: table-cell"></div>
  <div style="width: 50%; display: table-cell">
    <figure>
    <p>Machine classification of Tor traffic as<br>visits to
      Facebook or visits elsewhere</p>
    <img src="facebook-detect.svg" style="width:100%">
  </div>
</section>

<section class="slide question-slide">
  <div class="vcenter">
  <p style="font-size:400%">Questions?</p>

  <p style="font-size:1.5em;margin-top:2em">
    <code>zackw@cmu.edu</code><br>
    <a href="https://gitweb.torproject.org/stegotorus.git">https://gitweb.torproject.org/stegotorus.git</a><br>
    <a href="https://github.com/zackw/stegotorus/">https://github.com/zackw/stegotorus/</a></p>
</div>
</section>

<section>
  <div class="vcenter">
    <img src="traffic-analysis-resist-obfsp.svg">
  </div>
</section>

<section>
  <div class="vcenter">
    <img src="latency.svg">
  </div>
</section>


<!--
<form action="." method="get" class="goto-form">
  <label for="goto-slide">Go to slide:</label>
  <input type="text" name="slidenum" id="goto-slide" list="goto-datalist">
  <datalist id="goto-datalist"></datalist>
  <input type="submit" value="Go">
</form>-->

<script src="r/prez.js"></script>
</body>
</html>
